(function (d) {
    config.init();
    TabBlock.init();
    var a = Fx.getUrlParam("tab");
    if (!a) {
        a = 0
    }
    TabBlock.switchTab(d(".tabBlock-tab").eq(a));
    var f = Fx.getUrlParam("id") ? Fx.getUrlParam("id") : hzAPI.getToken().customerFamilyId;
    var c = {
        id: f,
        customerFamilyId: null,
        hospitalId: "1000",
        dateTime: Fx.getUrlParam("dateTime")
    };
    var e = true;
    var b = {
        addEvent: {
            doing: function () {
                d(".lists li a").on("tap",
                function () {
                    icoNav.popWinLayer(d(this).attr("vhref"))
                });
                icoNav.ton(".lists li a")
            }
        },
        doing: function () {
            //执行了两次 2016年11月8日12:05:28  
            b.getLastClinicDate.doing()
        },
        detail: {
            doing: function () {
                if (e) {
                    e = !e
                }
                c.dateTime = d("#getDate i").text().trim();
                c.clinicCode = d("#getDate b").text().trim();
                hzAPI.getData("http://ywtwx.dept.nfyy.com/ywtapi/?c=ReqHis&a=labTestList", c, "#lab ul", 2, true, null, false, "该次就诊没检验项目", b.addEvent);
                hzAPI.getData("http://ywtwx.dept.nfyy.com/ywtapi/?c=ReqHis&a=examList", c, "#exam ul", 3, true, null, false, "该次就诊没检查项目", b.addEvent)
            }
        },
        getLastClinicDate: {
            doing: function () {
                c.customerFamilyId = JSON.parse(d("#familyList .selected a").attr("data")).id;
                hzAPI.getData("http://ywtwx.dept.nfyy.com/ywtapi/?c=ReqHis&a=getLastClinicDate", c, "#getDate", 1, true, null, null, "近期无检验检查项目", b.detail, b.getLastClinicDate.err)
            },
            err: {
                doing: function () {
                    d("#lab ul, #exam ul").css({
                        display: "none"
                    })
                }
            }
        }
    };
    window.reload = b;
    hzAPI.getData("http://ywtwx.dept.nfyy.com/ywtapi/?c=Index&a=customerFamilyList", {
        idCk: Fx.getUrlParam("id")
    },
    "#familyList", 0, true, 4, true, null, b.getLastClinicDate)
})(Zepto);