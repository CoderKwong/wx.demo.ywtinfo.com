(function(d){config.init();TabBlock.init();var a={cardMasterId:null,iData:{doing:function(g){d.each(g,function(i,h){if(h.id==f){d("#ownership").val(h.ownership);d("#trueName").text(h.trueName);d("#card_trueName").text(h.trueName);d("#sex").val(h.sex);d("#nation").val(h.nation);d("#phone").val(h.phone);d("#tel").val(h.tel);d("#email").val(h.email);d("#idNo").text(h.idNo);d("#address").val(h.address);d(".lists ul").css({display:"block"})}else{hzAPI.dialog(false,2000,"该家庭成员关系已解除")}})}},iCard:{doing:function(g){a.cardMasterId=g[0].id;d("#cardId").val(g[0].cardId);a.iCard.bind.doing()},err:{doing:function(){a.cardMasterId=null;a.iCard.unBind.doing()},message:"诊疗卡未绑定"},bind:{doing:function(){d("#cardId").attr("readonly","readonly");d("#cardUnBindBlock").css({display:"block"});d("#cardBindBlock").css({display:"none"});d("#cardMoneyBlock").css({display:"block"})}},unBind:{doing:function(){d("#cardBindBlock").css({display:"block"});d("#cardUnBindBlock").css({display:"none"});d("#cardMoneyBlock").css({display:"none"});d("#cardId").removeAttr("readonly");d("#cardId").val("")}}}};var e={iData:function(){if(validate.check("#iData form")){var g={id:f,phone:d("#phone").val(),tel:d("#tel").val(),email:d("#email").val(),birthDay:d("#idNo").text().trim().substr(6,8).replace(/(.{4})(.{2})/,"$1-$2-"),address:d("#address").val(),sex:d("#sex").val(),nation:d("#nation").val(),province:null,city:null,area:null,ownership:d("#ownership").val()};if(g.ownership=="本人"){hzAPI.sendData("http://ywtwx.dept.nfyy.com/ywtapi/?c=Index&a=customerFamilySelfEdit",g,false,["修改失败","修改成功"])}else{hzAPI.sendData("http://ywtwx.dept.nfyy.com/ywtapi/?c=Index&a=customerFamilyEdit",g,false,["修改失败","修改成功"])}}},iCardBind:function(){if(validate.check("#iCard form")){var g={id:a.cardMasterId,customerFamilyId:f,hospitalId:d("#hospitalId").val(),cardType:"1",cardId:d("#cardId").val()};if(a.cardMasterId){hzAPI.sendData("http://ywtwx.dept.nfyy.com/ywtapi/?c=ReqHis&a=customerCardEdit",g,false,["重新绑定失败","重新绑定成功"],null,null,a.iCard.bind)}else{hzAPI.sendData("http://ywtwx.dept.nfyy.com/ywtapi/?c=ReqHis&a=customerCardAdd",g,false,["绑定失败","绑定成功"],null,null,a.iCard.bind)}}}};var b=Fx.getUrlParam("tab");if(!b){b=0}TabBlock.switchTab(d(".tabBlock-tab").eq(b));var f=Fx.getUrlParam("id");if(!f){f=hzAPI.getToken().customerFamilyId}var c={id:f,customerFamilyId:f,hospitalId:d("#hospitalId").val(),cardType:"1"};hzAPI.getDataNoTemp("http://ywtwx.dept.nfyy.com/ywtapi/?c=Index&a=customerFamilyInfo",c,a.iData);hzAPI.getDataNoTemp("http://ywtwx.dept.nfyy.com/ywtapi/?c=Index&a=customerCardList",c,a.iCard,a.iCard.err);d("#iDataUpdate").bind("tap",function(){e.iData()});d("#cardBind").bind("tap",function(){e.iCardBind()});d("#cardUnBind").bind("tap",function(){a.iCard.unBind.doing()});d("#cardMoney").bind("tap",function(){window.location="card.html?id="+f+"&hospitalId="+d("#hospitalId").val()})})(Zepto);